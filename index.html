<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tic Tac Toe Random Pattern</title>
<style>
  body {
    background: #111;
    color: #fff;
    font-family: monospace;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
  }
  table {
    border-collapse: collapse;
    margin-bottom: 10px;
  }
  td {
    width: 60px;
    height: 60px;
    text-align: center;
    vertical-align: middle;
    border: 2px solid #444;
    font-size: 24px;
    color: #0ff;
    position: relative;
  }
  .visited {
    background-color: #222;
  }
  .revisit {
    background-color: #f00 !important;
    color: #fff !important;
  }
  canvas {
    position: absolute;
    top: 0;
    left: 0;
    pointer-events: none;
  }
  #controls {
    margin-top: 10px;
  }
  button, input {
    margin: 4px;
    padding: 6px;
    background: #222;
    color: #0ff;
    border: 1px solid #0ff;
    border-radius: 4px;
  }
  #password {
    margin-top: 10px;
    font-size: 20px;
  }
</style>
</head>
<body>
  <table id="board"></table>
  <canvas id="arrows"></canvas>
  <div id="controls">
    <button id="randomize">Randomize & Start</button>
    <button id="reset">Reset</button>
    <label>Max password chars: <input type="number" id="maxChars" value="9" min="1" max="50"></label>
    <label>Speed (ms step): <input type="number" id="speed" value="500" min="50" max="2000"></label>
  </div>
  <div id="password">Password: </div>

  <script>
    const board = document.getElementById('board');
    const canvas = document.getElementById('arrows');
    const ctx = canvas.getContext('2d');
    const passwordEl = document.getElementById('password');

    const size = 3;
    let cells = [];
    let password = '';
    let interval = null;
    let maxChars = 9;
    let speed = 500;

    function createBoard() {
      board.innerHTML = '';
      cells = [];
      for (let y = 0; y < size; y++) {
        const row = document.createElement('tr');
        const rowCells = [];
        for (let x = 0; x < size; x++) {
          const cell = document.createElement('td');
          cell.contentEditable = true;
          cell.textContent = String.fromCharCode(33 + Math.floor(Math.random() * 94));
          row.appendChild(cell);
          rowCells.push(cell);
        }
        board.appendChild(row);
        cells.push(rowCells);
      }
      resizeCanvas();
    }

    function resizeCanvas() {
      const rect = board.getBoundingClientRect();
      canvas.width = rect.width;
      canvas.height = rect.height;
      canvas.style.top = rect.top + 'px';
      canvas.style.left = rect.left + 'px';
    }

    function randomDirection() {
      const dirs = [
        [1, 0], [-1, 0], [0, 1], [0, -1],
        [1, 1], [1, -1], [-1, 1], [-1, -1]
      ];
      return dirs[Math.floor(Math.random() * dirs.length)];
    }

    function inBounds(x, y) {
      return x >= 0 && x < size && y >= 0 && y < size;
    }

    function drawArrow(x1, y1, x2, y2, color = '#0f0') {
      const rect = board.rows[0].cells[0].getBoundingClientRect();
      const cellSize = rect.width;
      const offset = cellSize / 2;
      ctx.strokeStyle = color;
      ctx.fillStyle = color;
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(x1 * cellSize + offset, y1 * cellSize + offset);
      ctx.lineTo(x2 * cellSize + offset, y2 * cellSize + offset);
      ctx.stroke();

      const angle = Math.atan2(y2 - y1, x2 - x1);
      const arrowSize = 8;
      ctx.beginPath();
      ctx.moveTo(x2 * cellSize + offset, y2 * cellSize + offset);
      ctx.lineTo(x2 * cellSize + offset - arrowSize * Math.cos(angle - Math.PI / 6), y2 * cellSize + offset - arrowSize * Math.sin(angle - Math.PI / 6));
      ctx.lineTo(x2 * cellSize + offset - arrowSize * Math.cos(angle + Math.PI / 6), y2 * cellSize + offset - arrowSize * Math.sin(angle + Math.PI / 6));
      ctx.closePath();
      ctx.fill();
    }

    function startPattern() {
      clearInterval(interval);
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      password = '';
      maxChars = parseInt(document.getElementById('maxChars').value);
      speed = parseInt(document.getElementById('speed').value);

      const start = [Math.floor(Math.random() * size), Math.floor(Math.random() * size)];
      let [x, y] = start;
      let dir = randomDirection();
      password += cells[y][x].textContent[0];
      cells[y][x].classList.add('visited');

      interval = setInterval(() => {
        const [dx, dy] = dir;
        const nx = x + dx;
        const ny = y + dy;

        if (!inBounds(nx, ny)) {
          dir = randomDirection();
          return;
        }

        const nextChar = cells[ny][nx].textContent[0];
        let color = '#0f0';
        if (password.includes(nextChar)) color = '#ff0'; // yellow line if same char already used

        drawArrow(x, y, nx, ny, color);

        x = nx;
        y = ny;

        const cell = cells[y][x];
        const ch = cell.textContent[0];
        if (password.includes(ch)) {
          cell.classList.add('revisit');
        } else {
          cell.classList.add('visited');
        }
        password += ch;

        passwordEl.textContent = 'Password: ' + password;

        if (password.length >= maxChars || password.length >= size * size) {
          clearInterval(interval);
        }
      }, speed);
    }

    document.getElementById('randomize').onclick = () => {
      createBoard();
      startPattern();
    };

    document.getElementById('reset').onclick = () => {
      clearInterval(interval);
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      cells.forEach(r => r.forEach(c => {
        c.classList.remove('visited', 'revisit');
      }));
      password = '';
      passwordEl.textContent = 'Password: ';
    };

    createBoard();
  </script>
</body>
</html>
